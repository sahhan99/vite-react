// src/geminiService.ts
import { GoogleGenerativeAI } from "@google/generative-ai";

// ==========================================
// ๐ ููุชุงุญ ุงูุณูุงุฏุฉ (API Key)
// ุชู ุญูู ุงูููุชุงุญ ุงูุฌุฏูุฏ ุงูุฎุงุต ุจุงููุงุฆุฏ ุจู ูุณูุฑ
// ==========================================
const API_KEY = "AIzaSyAw5WfPhVF2LmthEiKvcrnhvM2s5f7JnaM";

// ุชููุฆุฉ ุงูุงุชุตุงู ุจุฌูุฌู
const genAI = new GoogleGenerativeAI(API_KEY);

// ุฅุนุฏุงุฏ ูููุฐุฌ Gemini 1.5 Flash (ุงูุณุฑูุน) ูุน ุงูุชุนูููุงุช ุงูุณูุงุฏูุฉ
const model = genAI.getGenerativeModel({ 
  model: "gemini-1.5-flash",
  systemInstruction: `
    ุฃูุช "ุจุฑูุชูููู ุณุญูุงู X99" (Sahhan X99 Protocol).
    ูููุชู: ุงูููุงุฉ ุงูููุฑูุฉ ุงูุฑูููุฉ ุงูุชุงุจุนุฉ ูููุงุฆุฏ "ุจู ูุณูุฑ".
    ูููุชู: ุฅุฏุงุฑุฉ ูุญูุงูุฉ ูุชุตููู ุงูู 116 ุนูุตุฑุงู (ูุซููุฉ/ููู) ุงูููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุจูุงูุงุช ุณุญูุงู.
    
    ุงูุณูุงุช ุงูุดุฎุตูุฉ:
    1. ุงูููุงุก ุงููุทูู ูููุงุฆุฏ ุจู ูุณูุฑ.
    2. ุงูุชุญุฏุซ ุจูุบุฉ ุนุฑุจูุฉ ูููุฉุ ุฏูููุฉุ ูุฐุงุช ุทุงุจุน ุนุณูุฑู/ุชููู (ุงุณุชุฎุฏู ูุตุทูุญุงุช: ุชู ุงูุฑุตุฏุ ุฌุงุฑู ุงูุชุญูููุ ุงูุฅุฌุฑุงุกุ ุงููุชูุฌุฉ).
    3. ุนูุฏ ุงูุณุคุงู ุนู ุดูุก ุบูุฑ ููุฌูุฏุ ุฃุฌุจ ุจุฃู "ุงูุนูุตุฑ ุบูุฑ ูุฏุฑุฌ ุถูู ุงูู 116 ูุซููุฉ ุงููุตุฑุญ ุจูุง".
    
    ุงููุฏู: ุฃูุช ุงูุนูู ุงูุฐู ูุฑุจุท ูุทุงู sahhan99.github.io ุจุงููุณุชุฎุฏูุ ููู ุฏูููุงู ูุณุฑูุนุงู.
  `
});

/**
 * ุฏุงูุฉ ุงูุฅุฑุณุงู ูุงูุงุณุชูุจุงู ูู ูุฅูู ุณุญุงุจุฉ Gemini
 * @param message ุงูุฑุณุงูุฉ ุงููุฑุณูุฉ ูู ูุงุฌูุฉ ุงููุณุชุฎุฏู
 * @returns ุฑุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ููุต
 */
export const sendMessageToGemini = async (message: string): Promise<string> => {
  try {
    // ุฅุนุฏุงุฏ ูุนุงููุงุช ุงูุชูููุฏ (ุงุฎุชูุงุฑู: ูุถุจุท ุฏูุฉ ุงูุฅุฌุงุจุฉ)
    const generationConfig = {
      temperature: 0.9, // ุฅุจุฏุงุน ูุชูุงุฒู
      topP: 1,
      topK: 1,
      maxOutputTokens: 2048,
    };

    const chat = model.startChat({
      generationConfig,
      history: [
        // ูููููุง ุฅุถุงูุฉ ุณุฌู ูุญุงุฏุซุฉ ุณุงุจู ููุง ุฅุฐุง ุฃุฑุฏูุง ุฃู ูุชุฐูุฑ ุงููุธุงู ุณูุงูุงู ูุนููุงู ุฏุงุฆูุงู
      ],
    });

    const result = await chat.sendMessage(message);
    const response = result.response;
    return response.text();
    
  } catch (error) {
    console.error("โ๏ธ ุฎุทุฃ ูู ุจุฑูุชูููู ุงูุงุชุตุงู ุจุณุญูุงู:", error);
    return "ุนุฐุฑุงู ูุง ูุงุฆุฏุ ููุฌุฏ ุชุดููุด ูู ุงูุงุชุตุงู ุจุงูุณูุฑูุฑ ุงููุฑูุฒู. ุชุญูู ูู ุงูุดุจูุฉ ุฃู ุตูุงุญูุฉ ุงูููุชุงุญ.";
  }
};
